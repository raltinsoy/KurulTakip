@model IEnumerable<KurulTakipSistemi.Models.sp_GetSecilenKurulAksiyon_Result>
@{
    ViewBag.SolMenuIdUret = Request.RequestContext.RouteData.Values["id"];
    ViewBag.link = Html.ActionLink("Yeni Aksiyon", "Create", 
        new { id = Request.RequestContext.RouteData.Values["id"] });
}

<style>
    label{
        width:150px;
    }
</style>

<script>
    $("#menu4").addClass("active");
</script>

@if (Model != null)
{
    var geciciModel = Model.ToList();
    <table class="table table-hover table-striped">
        <tr>
            <th>#</th>
            <th>@Html.DisplayNameFor(m => m.KriterNo)</th>
            <th>@Html.DisplayNameFor(model => model.GorusulenKonu)</th>
            <th>@Html.DisplayNameFor(model => model.MevcutDurumu)</th>
            <th>@Html.DisplayNameFor(model => model.SorumluPers)</th>
            <th>@Html.DisplayNameFor(model => model.GundemeTarihi)</th>
            <th>@Html.DisplayNameFor(model => model.HedefTarihi)</th>
            <th>@Html.DisplayNameFor(model => model.Sonuc)</th>
            <th></th>
        </tr>
        @{int sayac = 1;}
        @foreach (var item in geciciModel)
        {
            <tr style="cursor:pointer;">
                <td data-toggle="modal" 
                    data-target=".bs-example-modal-lg-@item.AksiyonID">@sayac</td>
                <td data-toggle="modal" 
                    data-target=".bs-example-modal-lg-@item.AksiyonID">
                @Html.DisplayFor(m => item.KriterNo)</td>
                <td data-toggle="modal" 
                    data-target=".bs-example-modal-lg-@item.AksiyonID" style="padding:5px;">
                <div class="form-control" style="overflow:auto;height:70px;">
                    @Html.DisplayFor(m => item.GorusulenKonu )</div></td>
                <td data-toggle="modal" 
                    data-target=".bs-example-modal-lg-@item.AksiyonID" style="padding:5px;">
                <div class="form-control" style="overflow:auto;height:70px;">
                    @Html.DisplayFor(m => item.MevcutDurumu)</div></td>
                <td data-toggle="modal" 
                    data-target=".bs-example-modal-lg-@item.AksiyonID">
                @Html.DisplayFor(m => item.SorumluPers)</td>
                <td data-toggle="modal" 
                    data-target=".bs-example-modal-lg-@item.AksiyonID">
                @Html.DisplayFor(m => item.GundemeTarihi)</td>
                <td data-toggle="modal" 
                    data-target=".bs-example-modal-lg-@item.AksiyonID">
                @Html.DisplayFor(m => item.HedefTarihi)</td>
                <td data-toggle="modal" 
                    data-target=".bs-example-modal-lg-@item.AksiyonID">
                @Html.DisplayFor(m => item.Sonuc)</td>
                <td style="cursor:default;">
                    @Html.ActionLink("Düzenle", "Edit", "Aksiyonlar", new { id = @item.AksiyonID }, null)
                    <a href="#" class="delete-user-row-with-ajax-button" 
                       data-type="@sayac - @item.SorumluPers" data-deger="@item.AksiyonID">Sil</a>
                </td>
            </tr>
            sayac++;
        }
    </table>

    foreach (var i in geciciModel)
    {
        <div class="modal fade bs-example-modal-lg-@i.AksiyonID" tabindex="-1" 
             role="dialog" aria-labelledby="myLargeModalLabel">
            <div class="modal-dialog modal-lg" style="width:860px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" 
                                aria-label="Close"><span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title" id="myModalLabel">@if (ViewBag.KurulAdi!=null)
                                                                  {@ViewBag.KurulAdi} - Detay</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            @Html.LabelFor(m => i.GorusulenKonu, 
                            htmlAttributes: new { @class = "control-label", @style = "float:left;" })
                            <div>
                                @Html.TextAreaFor(model => i.GorusulenKonu, 3, 5,
                                new { @class = "form-control", @style = "max-width:600px;" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(m => i.MevcutDurumu, htmlAttributes: new { @class = "control-label", @style = "float:left;" })
                            <div>
                                @Html.TextAreaFor(model => i.MevcutDurumu, 3, 5, new { @class = "form-control", @style = "max-width:600px;" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(m => i.Gelisme, htmlAttributes: new { @class = "control-label", @style = "float:left;" })
                            <div>
                                @Html.TextAreaFor(model => i.Gelisme, 3, 5, new { @class = "form-control", @style = "max-width:600px;" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(m => i.AksiyonSonucu, htmlAttributes: new { @class = "control-label", @style = "float:left;" })
                            <div>
                                @Html.TextAreaFor(model => i.AksiyonSonucu, 3, 5, new { @class = "form-control", @style = "max-width:600px;" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(m => i.SorumluPersoneller, htmlAttributes: new { @class = "control-label", @style = "float:left;" })
                            <div>
                                @Html.EditorFor(model => i.SorumluPersoneller, new { htmlAttributes = new { @class = "form-control" } })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(m => i.KriterNo, htmlAttributes: new { @class = "control-label", @style = "float:left;" })
                            <div>
                                @Html.EditorFor(model => i.KriterNo, new { htmlAttributes = new { @class = "form-control" } })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(m => i.GundemeTarihi, htmlAttributes: new { @class = "control-label", @style = "float:left;" })
                            <div>
                                @Html.EditorFor(model => i.GundemeTarihi, new { htmlAttributes = new { @class = "form-control" } })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(m => i.HedefTarihi, htmlAttributes: new { @class = "control-label", @style = "float:left;" })
                            <div>
                                @Html.EditorFor(model => i.HedefTarihi, new { htmlAttributes = new { @class = "form-control" } })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(m => i.IsBitisTarihi, htmlAttributes: new { @class = "control-label", @style = "float:left;" })
                            <div>
                                @Html.EditorFor(model => i.IsBitisTarihi, new { htmlAttributes = new { @class = "form-control" } })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(m => i.Sonuc, htmlAttributes: new { @class = "control-label", @style = "float:left;" })
                            <div>
                                @Html.TextAreaFor(model => i.Sonuc, 3, 5, new { @class = "form-control", @style = "max-width:600px;" })
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    }
}

<script src="~/Scripts/bootstrap-confirm-delete.js"></script>
<script src="~/Scripts/deleteSettings.js"></script>

<script>
    $('.delete-user-row-with-ajax-button').bootstrap_confirm_delete(
        {
            heading:"Aksiyon Sorumlusu",
            callback: function (event) {
                $.ajax(
                {
                    dataType: 'text',
                    url: "/Aksiyonlar/DeleteConfirmedAjax",
                    data: { id: $(event.data.originalObject).data('deger') },
                    success: function (result) {
                        var button = event.data.originalObject;
                        if (result == false) {
                            $("#hata").hide();
                            $("#hata").text("Silme islemi gerceklestirilemedi.");
                            $("#hata").show("slow");
                            setTimeout(function () {
                                $("#hata").hide("slow");
                            }, 4000);
                        }
                        else { button.closest('tr').remove();
                        }
                    },
                    error: function () {
                        $("#hata").hide();
                        document.getElementById("hata").innerHTML =
                            "Silme islemi gerceklestirilemedi."
                        $("#hata").show("slow");
                        setTimeout(function () {
                            $("#hata").hide("slow");
                        }, 4000);
                    }
                });}});
</script>

